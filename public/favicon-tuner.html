<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moral Knight Favicon Tuner</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #f4f4f4;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        h1 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .row {
            display: flex;
            gap: 40px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            min-width: 300px;
        }

        .canvas-wrapper {
            position: relative;
            width: 192px;
            height: 192px;
            margin: 0 auto;
        }

        canvas {
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fff;
            /* checkered pattern usually better but white is fine */
            image-rendering: pixelated;
        }

        /* Overlays for Numbers */
        .overlay-num {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            pointer-events: none;
        }

        #ov1 {
            top: 10px;
            left: 10px;
            border: 2px solid #FFD700;
            color: #FFD700;
        }

        #ov2 {
            top: 80px;
            left: 80px;
            border: 2px solid #4caf50;
            color: #4caf50;
        }

        #ov3 {
            top: 60px;
            left: 140px;
            border: 2px solid #00bcd4;
            color: #00bcd4;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 6px;
            background: #f9f9f9;
            border: 1px solid #eee;
        }

        .badge {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #000;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .badge-1 {
            background: #FFD700;
            color: #000;
        }

        /* Gold Border */
        .badge-2 {
            background: #4caf50;
            color: #fff;
        }

        /* Body */
        .badge-3 {
            background: #00bcd4;
            color: #fff;
        }

        /* Highlights */

        .controls label {
            display: block;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }

        input[type=range] {
            width: 100%;
        }

        .zone-toggle {
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 10px;
            background: #eee;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            user-select: none;
        }

        .zone-toggle:hover {
            background: #e0e0e0;
        }

        code {
            background: #333;
            color: #0f0;
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>üõ°Ô∏è Favicon Tuner (v2)</h1>
        <p>Adjust the 3 key zones of the Moral Knight shield independently. <br>The numbers on the preview indicate the
            center of each zone.</p>

        <div class="row">
            <div class="col" style="flex: 0 0 300px; text-align: center;">
                <h3>Live Preview</h3>
                <div class="canvas-wrapper">
                    <canvas id="mainCanvas" width="192" height="192" style="width: 192px; height: 192px;"></canvas>
                    <div id="ov1" class="overlay-num">1</div>
                    <div id="ov2" class="overlay-num">2</div>
                    <div id="ov3" class="overlay-num">3</div>
                </div>

                <div class="zone-toggle" onclick="toggleZones()">
                    üëÅÔ∏è Toggle Color Map
                </div>
                <p><small>Click toggle to see exactly which pixels belong to which zone.</small></p>
            </div>

            <div class="col">
                <h3>Zones & Settings</h3>

                <!-- Zone 1 -->
                <div class="legend-item">
                    <div class="badge badge-1">1</div>
                    <div style="flex:1">
                        <strong>Border (The Frame)</strong>
                        <div class="controls">
                            <label>Brightness: <span id="v1-val">150%</span></label>
                            <input type="range" id="v1" min="100" max="200" value="150" oninput="update()">
                            <label>Saturation: <span id="s1-val">120%</span></label>
                            <input type="range" id="s1" min="100" max="150" value="120" oninput="update()">
                        </div>
                    </div>
                </div>

                <!-- Zone 2 -->
                <div class="legend-item">
                    <div class="badge badge-2">2</div>
                    <div style="flex:1">
                        <strong>Shield Body (The Fill)</strong>
                        <div class="controls">
                            <label>Target Gold Color (Hue): <span id="h2-val">0.13</span></label>
                            <input type="range" id="h2" min="0" max="100" value="13" oninput="update()">
                            <label>Saturation: <span id="s2-val">90%</span></label>
                            <input type="range" id="s2" min="0" max="100" value="95" oninput="update()">
                        </div>
                    </div>
                </div>

                <!-- Zone 3 -->
                <div class="legend-item">
                    <div class="badge badge-3">3</div>
                    <div style="flex:1">
                        <strong>Eyes / Diagonal Stripes (Highlights)</strong>
                        <div class="controls">
                            <label>Force Brightness (0=Original, 1=Max): <span id="v3-val">1.0</span></label>
                            <input type="range" id="v3" min="0" max="100" value="100" oninput="update()">
                        </div>
                    </div>
                </div>

                <button onclick="copySettings()"
                    style="background:#111; color:#fff; border:none; padding:10px 20px; border-radius:6px; cursor:pointer;">üìã
                    Copy Settings for Developer</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        let originalData = null;
        let showingZones = false;

        // Load original image (Blue/Green version)
        const img = new Image();
        img.src = '/favicon-original.png';
        img.onload = () => {
            // Draw to offscreen for data extraction
            const offCanvas = document.createElement('canvas');
            offCanvas.width = 96; offCanvas.height = 96;
            const offCtx = offCanvas.getContext('2d');
            offCtx.drawImage(img, 0, 0);
            originalData = offCtx.getImageData(0, 0, 96, 96);
            update();
        };

        function rgbToHsv(r, g, b) {
            r /= 255, g /= 255, b /= 255;
            var max = Math.max(r, g, b), min = Math.min(r, g, b);
            var h, s, v = max;
            var d = max - min;
            s = max == 0 ? 0 : d / max;
            if (max == min) { h = 0; }
            else {
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return [h, s, v];
        }

        function hsvToRgb(h, s, v) {
            var r, g, b;
            var i = Math.floor(h * 6);
            var f = h * 6 - i;
            var p = v * (1 - s);
            var q = v * (1 - f * s);
            var t = v * (1 - (1 - f) * s);
            switch (i % 6) {
                case 0: r = v, g = t, b = p; break;
                case 1: r = q, g = v, b = p; break;
                case 2: r = p, g = v, b = t; break;
                case 3: r = p, g = q, b = v; break;
                case 4: r = t, g = p, b = v; break;
                case 5: r = v, g = p, b = q; break;
            }
            return [r * 255, g * 255, b * 255];
        }

        function update() {
            if (!originalData) return;

            // Settings
            const v1_mult = document.getElementById('v1').value / 100;
            const s1_mult = document.getElementById('s1').value / 100;

            const gold_h = document.getElementById('h2').value / 100;
            const gold_s = document.getElementById('s2').value / 100;

            const v3_force = document.getElementById('v3').value / 100;

            // UI
            document.getElementById('v1-val').innerText = Math.round(v1_mult * 100) + '%';
            document.getElementById('s1-val').innerText = Math.round(s1_mult * 100) + '%';
            document.getElementById('h2-val').innerText = gold_h;
            document.getElementById('s2-val').innerText = Math.round(gold_s * 100) + '%';
            document.getElementById('v3-val').innerText = v3_force;

            const w = 96; const h = 96;
            const processed = new ImageData(w, h);
            const input = originalData.data;
            const output = processed.data;

            for (let i = 0; i < input.length; i += 4) {
                const r = input[i]; const g = input[i + 1]; const b = input[i + 2]; const a = input[i + 3];

                if (a === 0) { output[i + 3] = 0; continue; }

                const [hue, sat, val] = rgbToHsv(r, g, b);

                let finalR = r, finalG = g, finalB = b;
                let zone = 0;

                // ZONE 1: Border (Generic Gold)
                if (hue >= 0.08 && hue <= 0.16 && sat > 0.4 && val > 0.2) {
                    zone = 1;
                    if (!showingZones) {
                        const [nr, ng, nb] = hsvToRgb(hue, Math.min(1, sat * s1_mult), Math.min(1, val * v1_mult));
                        finalR = nr; finalG = ng; finalB = nb;
                    }
                } else {
                    // ZONE 2 & 3: EVERYTHING ELSE (except transparent)
                    // This acts as a catch-all for Body & Eyes to ensure 100% gold coverage

                    // Check if it's a Highlight (Zone 3)
                    if (val > 0.5) {
                        zone = 3;
                        if (!showingZones) {
                            // Mix between Original V and Max V based on slider
                            const targetV = 0.6 + (v3_force * 0.4); // 0.6 -> 1.0
                            const targetS = gold_s * (1 - (v3_force * 0.2)); // Desaturate slightly if very bright

                            const [nr, ng, nb] = hsvToRgb(gold_h, targetS, targetV);
                            finalR = nr; finalG = ng; finalB = nb;
                        }
                    } else {
                        // Zone 2: Body (Darker parts)
                        zone = 2;
                        if (!showingZones) {
                            const [nr, ng, nb] = hsvToRgb(gold_h, gold_s, Math.min(1, val * 1.1));
                            finalR = nr; finalG = ng; finalB = nb;
                        }
                    }
                }

                if (showingZones) {
                    if (zone == 1) { finalR = 255; finalG = 215; finalB = 0; } // Gold
                    else if (zone == 2) { finalR = 76; finalG = 175; finalB = 80; } // Green
                    else if (zone == 3) { finalR = 0; finalG = 188; finalB = 212; } // Cyan
                    else { finalR = 255; finalG = 0; finalB = 0; } // Red (Should not happen if logic is correct)
                }

                output[i] = finalR;
                output[i + 1] = finalG;
                output[i + 2] = finalB;
                output[i + 3] = a;
            }

            // Put data to main canvas (scaled)
            const offCanvas = document.createElement('canvas');
            offCanvas.width = 96; offCanvas.height = 96;
            offCanvas.getContext('2d').putImageData(processed, 0, 0);

            ctx.clearRect(0, 0, 192, 192);
            ctx.scale(2, 2);
            ctx.drawImage(offCanvas, 0, 0);
            ctx.scale(0.5, 0.5); // Reset scale
        }

        function toggleZones() {
            showingZones = !showingZones;
            update();
        }

        function copySettings() {
            const txt = `Settings:\nZone 1 (Border): Bri ${document.getElementById('v1').value}%, Sat ${document.getElementById('s1').value}%\nZone 2 (Body): Hue ${document.getElementById('h2').value}, Sat ${document.getElementById('s2').value}%\nZone 3 (Eyes): Highlight Force ${document.getElementById('v3').value}%`;
            navigator.clipboard.writeText(txt);
            alert("Settings copied! Paste them in the chat.");
        }
    </script>

</body>

</html>